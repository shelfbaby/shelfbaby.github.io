import{p as e,v as s,Y as a,r as t,M as l,j as r,F as n,f as i,Q as c,K as d}from"./index-ae48b77e.js";import{r as o,n as x,X as m,C as u,T as h,a as p}from"./app-6c1e0ad4.js";import{l as f}from"./lodash-1e7c8add.js";import{C as j}from"./modal.constants-197ec555.js";import{A as b,F as g,S as N,a as k,V as v,T as C,E as _}from"./edit-419fc5f0.js";import{L as y}from"./label-d0c29119.js";import{u as w}from"./useMount-1a9a34d7.js";const I=e((({prefix:e,suffix:d,multiple:u=!1,disabled:h=!1,createChannel:p=!1,createChannelLabel:j="channelsSelector.title.create_one_for_me",value:g=(u?[]:null),autoselectFirst:N=!1,onlyChannels:k=!1,onlyVoiceChannels:v=!1,onlyCategories:C=!1,voiceChannels:_=!1,forumChannels:I=!1,className:D="",label:G="fields.channel",required:L=!1,name:E,displayLabel:O=!1,renderPlaceholder:T=null,placeholder:V="select.channels.placeholder",tooltip:A,includeTickets:F=!1,eventName:$,onChange:P})=>{const{guild:X}=s(),q=a(),W=t.useRef(null),Y=t.useRef(null),H=t.useRef(null);l(W);const[J,z]=t.useState(g||(u?[]:null)),[B,K]=t.useState(M(X,k,C,u,_,I,v,F)),[Q,Z]=t.useState(!1),[ee,se]=t.useState(""),ae=`${E??f.uniqueId()}-channel_selector`,te=e=>{if(u&&J?.includes(e))return z((()=>J.filter((s=>s!==e))));z(u?[...J,e]:e)};o((()=>{if(P)return P(J),u?void 0:Z(!1)}),[J]),o((()=>{JSON.stringify(g)!==JSON.stringify(J)&&z(g||(u?[]:null))}),[g]),o((()=>{K(M(X,k,C,u,_,I,v,F,ee))}),[X?.channels,X?.ignored_channel_ids,ee]),o((()=>{Q&&H.current?.focus()}),[Q]);const le=()=>{if(J&&0!==J?.length)return u?J.map(((e,s)=>r.jsx(S,{id:e,onDelete:te},e))):J===R?r.jsx("p",{className:"text-dark-100 text-base",children:r.jsx(n,{id:j})}):r.jsx(S,{id:J,theme:"single"})};w((()=>{if(!J||u||X?.channels[J]||J===R||z(null),J&&u){const e=J.filter((e=>X?.channels[e]));e.length!==J.length&&z(e)}}));const re=e=>(!J||0===J?.length)&&(T??r.jsx("p",{className:i(`text-dark-300 text-base ${e}`,{"!text-dark-400":h}),children:r.jsx(n,{id:V})}));return N&&B.length>0&&null===J&&te(B[0].id),r.jsxs("div",{className:`${D} ${-1===D?.indexOf("w-")?"max-w-field":""}`,onClick:e=>{e.stopPropagation(),e.preventDefault()},children:[(O||"fields.channel"!==G)&&r.jsx(y,{required:L,children:r.jsx(n,{id:G})}),r.jsxs("div",{ref:W,id:ae,className:"relative w-full",children:[r.jsxs("div",{className:i("rounded-lg cursor-pointer bg-dark-900 min-h-[50px] px-2 flex items-center justify-start border border-solid transition duration-200 ring-opacity-30",{"border-brand-default ring-[4px] ring-brand-default":Q,"border-dark-900":!Q,"cursor-not-allowed opacity-70 italic":h}),onClick:h?()=>{}:()=>Z(!0),children:[e&&r.jsx("div",{className:"pl-2",children:e}),r.jsxs("div",{className:i("w-full flex items-center justify-start flex-wrap py-2",{"pl-3":e,"pr-3":d,"pl-2":!e,"pr-2":!d,"py-1":!e&&!d}),children:[u&&r.jsxs("div",{className:"flex items-center justify-start flex-wrap gap-2",children:[le(),!h&&r.jsx("div",{children:r.jsx(b,{fill:c[900],className:"cursor-pointer text-dark-300 -ml-px",onClick:()=>Z(!0)})}),Q?r.jsx("input",{ref:H,type:"text",placeholder:q.formatMessage({id:"channelsSelector.search"}),className:"flex-1 bg-transparent outline-none border-none pl-1 text-dark-300 text-base",onChange:e=>se(e.target.value)}):re("ml-2")]}),!u&&r.jsxs("div",{className:i("cursor-pointer flex items-center justify-between w-full trigger-dropdown",{"!cursor-not-allowed":h}),onClick:h?()=>{}:()=>Z(!0),children:[le(),Q?r.jsx("input",{ref:H,type:"text",placeholder:q.formatMessage({id:"channelsSelector.search"}),className:"flex-1 bg-transparent outline-none border-none pl-1 text-dark-300 text-base",onChange:e=>se(e.target.value)}):re(),r.jsx(x,{className:i("text-dark-300 ml-auto transform transition-all duration-200",{"-rotate-180":Q})})]})]}),d&&r.jsx("div",{children:d})]}),A&&r.jsxs("div",{className:"flex items-center justify-start text-dark-400 text-xs mt-2",children:[r.jsx(m,{className:"mr-1 text-dark-400 h-4 w-4"}),r.jsx(n,{id:A})]}),r.jsx(U,{ref:Y,value:J,channels:B,visible:Q,multiple:u,onlyCategories:C,onlyChannels:k,createChannel:p,createChannelLabel:j,onSelect:te,onDismiss:()=>Z(!1),onSelectAll:e=>(e=>{if(e)return z(u?[]:null);z((()=>B.map((e=>e.id))))})(e)})]})]})})),D=({channel:e,className:s="h-4 w-4"})=>{let a=null;const t=`text-dark-100 ${s}`;switch(e?.type){case O.GUILD_TEXT:a=r.jsx(C,{className:t});break;case O.GUILD_VOICE:a=r.jsx(v,{className:t});break;case O.GUILD_NEWS:a=r.jsx(k,{className:t});break;case O.GUILD_STAGE_VOICE:a=r.jsx(N,{className:t});break;case O.GUILD_FORUM:a=r.jsx(g,{className:t})}return a},S=({id:e,theme:a="multiple",className:l,onDelete:c})=>{const{guild:d}=s(),o=t.useMemo((()=>d?.channels?.[e]),[e]),x=t.useMemo((()=>!o),[o]);return"multiple"===a?r.jsx("div",{className:i(`inline-block font-medium rounded-full text-sm px-2 pr-4 py-0.5 bg-opacity-[0.16] max-w-max ${l}`,{"text-dark-100 bg-dark-100":!x,"text-danger-default bg-danger-default":x}),children:r.jsxs("div",{className:"flex items-center justify-start",children:[r.jsx(j,{className:i("mr-2 cursor-pointer w-2.5",{"text-danger-default":x,"text-dark-200":!x}),onClick:c?()=>c(e):void 0}),r.jsx(D,{channel:o,className:"mr-1 h-4 w-4"}),x?r.jsx(n,{id:"deletedChannel"}):o?.name]})}):r.jsxs("div",{className:"text-base font-medium text-dark-100 flex items-center justify-start",children:[r.jsx(D,{channel:o,className:"mr-1 h-4 w-4"}),o?.name]})},G=({name:e,value:s,disabled:a=!1,checked:c=!1,title:o,description:x,className:m,onChange:h=(()=>{}),onClick:p})=>{const f=t.useRef(null),j=t.useRef(null);l(j);const b=`checkbox-${d()}`;return r.jsxs("div",{ref:j,className:`flex items-start justify-start cursor-pointer ${m}`,children:[r.jsx("input",{type:"checkbox",name:e,value:b,className:"sr-only peer",id:b,onChange:()=>{a||h(!s)},onClick:p||(()=>{})}),r.jsx("label",{ref:f,htmlFor:b,className:i("cursor-pointer overflow-hidden w-5 h-5 flex items-center justify-center rounded border-[1px] border-solid transition-all duration-200 hover:border-brand-default",{"border-brand-default !bg-brand-default":!a&&s,"bg-dark-500 border-dark-700":!s,"bg-dark-500 hover:border-dark-700 border-dark-700":a,"transform translate-y-0.5":o,"!cursor-not-allowed":a}),children:r.jsx(u,{className:i("h-2 w-2 transition-all duration-200 transform",{"-translate-y-6":!c&&!s,"text-dark-700":a,"text-white":!a})})}),(o||x)&&r.jsxs("label",{ref:f,htmlFor:b,className:i("ml-2 select-none cursor-pointer",{"!cursor-not-allowed":a}),children:[o&&r.jsx("p",{className:"text-dark-100 text-base",children:r.jsx(n,{id:o})}),x&&r.jsx("p",{className:"text-dark-300 text-sm",children:r.jsx(n,{id:x})})]})]})},L=({stroke:e="currentColor",fill:s="transparent",...a})=>r.jsx("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...a,children:r.jsx("path",{d:"M17.451 6.783H6.547a.803.803 0 00-.809.808v8.296a.804.804 0 00.809.809h2.322v2.608l2.608-2.608h5.974a.803.803 0 00.809-.809V7.591a.803.803 0 00-.809-.808z",fill:e})}),U=t.forwardRef((({value:e,channels:s,visible:a,multiple:l,createChannel:d,createChannelLabel:x="channelsSelector.title.create_one_for_me",onlyCategories:m,onlyChannels:f,onSelect:j,onDismiss:g,onSelectAll:N},k)=>{const[v,C]=t.useState(!1),[y,w]=t.useState([]);t.useImperativeHandle(k,(()=>({close(){}})));const I=s=>{const a=e?.includes(s.id)??e===s.id,t=!!s?.parent_id&&(e?.includes(s.parent_id)??e===s.parent_id),n=y?.includes(s.id);switch(s.type){case O.GUILD_TEXT:case O.GUILD_VOICE:case O.GUILD_NEWS:case O.GUILD_STAGE_VOICE:case O.GUILD_FORUM:return r.jsxs(E,{isSelected:a||t,onClick:t?()=>{}:()=>j(s.id),children:[r.jsxs("div",{className:"flex items-center justify-start text-base",children:[l&&r.jsx(G,{onClick:e=>{e.stopPropagation()},checked:a||t,disabled:t,className:"mr-3"}),r.jsx(D,{channel:s,className:"mr-1.5 h-4 w-4"}),s.name]}),r.jsxs("div",{className:"flex items-center justify-end",children:[s.type===O.GUILD_VOICE&&r.jsx(L,{}),a&&!l&&r.jsx(u,{className:"text-brand-default ml-1"})]})]},s.id);case O.GUILD_CATEGORY:return r.jsxs("div",{children:[r.jsxs(E,{isSelected:a,onClick:()=>j(s.id),children:[r.jsxs("div",{className:"flex items-center justify-start uppercase text-dark-200 text-xs font-bold",children:[l&&r.jsx(G,{checked:a,className:"mr-3"}),s.name]}),!l&&r.jsx(u,{className:`text-brand-default ml-1 ${!a&&"opacity-0"}`}),l&&s?.channels?.length>0&&r.jsx(p,{className:i("text-dark-300 rounded hover:bg-dark-800 cursor-pointer transition-all duration-200 transform",{"rotate-180":!n}),onClick:e=>{if(e.preventDefault(),e.stopPropagation(),n)return w(y.filter((e=>e!==s.id)));w([...y,s.id])}})]}),!n&&s?.channels&&r.jsx("div",{className:"pl-3 grid grid-cols-1 gap-y-1.5 mt-1.5",children:s.channels.map(I)})]},s.id)}};return o((()=>{if(l&&0===e?.length)return C(!1)}),[e]),r.jsxs(h,{visible:a,onDismiss:g,children:[(l||d)&&r.jsx("ul",{className:"border-b border-solid border-dark-700 pb-3 mb-4",children:r.jsxs(r.Fragment,{children:[r.jsx("p",{className:"uppercase text-dark-400 font-bold text-xs mt-3 mb-2 px-2",children:r.jsx(n,{id:"channelsSelector.title.options"})}),l&&r.jsxs("li",{className:"flex p-2 rounded-lg items-center justify-start text-dark-100 text-base font-medium hover:bg-dark-800 transition duration-200 cursor-pointer",onClick:()=>{N(v),C(!v)},children:[r.jsx(b,{fill:c[900],className:"text-dark-300 mr-2"}),r.jsx(n,{id:v?"channelsSelector.title.remove_all":"channelsSelector.title.add_all"})]}),!l&&d&&r.jsxs("li",{className:i("flex p-2 rounded-lg items-center justify-between text-dark-100 text-base font-medium hover:bg-dark-800 transition duration-200 cursor-pointer",{"bg-dark-800":e===R}),onClick:()=>j(R),children:[r.jsxs("div",{className:"flex items-center justify-start",children:[r.jsx(_,{fill:c[900],className:"text-dark-300 mr-2"}),r.jsx(n,{id:x})]}),e===R&&r.jsx(u,{className:"text-brand-default ml-1"})]})]})}),r.jsxs("div",{className:"grid grid-cols-1 gap-y-1.5 pt-1",children:[r.jsx("p",{className:"uppercase text-dark-400 font-bold text-xs px-2 mb-0.5",children:m?r.jsx(n,{id:"channelsSelector.title.categories"}):!l||f?r.jsx(n,{id:"channelsSelector.title.channels"}):r.jsx(n,{id:"channelsSelector.title.channels_and_categories"})}),s?.length>0?s.map((e=>I(e))):r.jsx("p",{className:"text-grey-300 px-2 mb-1",children:r.jsx(n,{id:"channelsSelector.title.no_channels"})})]})]})})),E=({isSelected:e,children:s,onClick:a})=>r.jsx("div",{children:r.jsx("div",{className:i("flex items-center justify-between p-2 rounded hover:bg-dark-700 cursor-pointer",{"bg-dark-700":e}),onClick:a,children:s})});var O=(e=>(e[e.GUILD_TEXT=0]="GUILD_TEXT",e[e.DM=1]="DM",e[e.GUILD_VOICE=2]="GUILD_VOICE",e[e.GROUP_DM=3]="GROUP_DM",e[e.GUILD_CATEGORY=4]="GUILD_CATEGORY",e[e.GUILD_NEWS=5]="GUILD_NEWS",e[e.GUILD_STAGE_VOICE=13]="GUILD_STAGE_VOICE",e[e.GUILD_FORUM=15]="GUILD_FORUM",e))(O||{});const T=e=>e.sort(((e,s)=>e.position-s.position)),M=(e,s,a,t,l,r,n,i,c)=>{const d=[];a?d.push(4):n?d.push(2,13):(d.push(0,5),l&&d.push(2,13),r&&d.push(15));const o=Object.values(e?.channels?e.channels:{}),x=new Map(o.filter((e=>4===e.type)).map((e=>[e.id,e]))),m=o.filter(((s,a)=>{if(d.includes(s.type)&&(i||!e?.ignored_channel_ids||!e?.ignored_channel_ids?.includes(s.id)))return!c||""===c||s?.name?.toLowerCase().includes(c?.toLowerCase())?s:void 0}));if(!t||n||s||a)return T(m);const u=[];return m.forEach(((e,s)=>{if(e.parent_id){const s=u.findIndex((s=>s.id===e.parent_id));-1!==s?u[s].channels.push(e):u.push({...x.get(e.parent_id),channels:[e]})}else u.push(e)})),T(u)},R="1420070400000";export{G as C,R as N,I as a,O as b};
